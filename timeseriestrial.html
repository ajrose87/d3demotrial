<!DOCTYPE html>

<head> 
	<link rel="shortcut icon" type="image/png" href="images/favicon.png"/>
    <link rel="stylesheet" href="resources/default.css" />
    <link rel="stylesheet" href="style.css" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.1.0/lodash.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script src="timeseries.js"></script>
</head>

<body>
    <div class="container">
		<p> 
			<pre><code class="html">&lt;div class="timeseries"&gt;&lt;/div&gt;</code></pre>
			<pre><code class="javascript">var data = [{'value': 1380854103662},{'value': 1363641921283}];</code></pre>
			<pre><code class="javascript">timeseries('timeseries', data, true);</code></pre>
		</p>
    </div>

    <script>
		hljs.initHighlightingOnLoad();
		
		window.onload = function() {
		
			"use strict";
			
			function onMessage (evt) {
				if (evt && evt.data && evt.data.hasOwnProperty("data"))
					updateData(evt.data);
			}

			if (window.addEventListener) {
				// For standards-compliant web browsers
				window.addEventListener("message", onMessage, false);
			}
			else {
				window.attachEvent("onmessage", onMessage);
			}
			
			var self = this;
			
			function updateData(chartData)
			{
				console.dir(chartData);
				
				var xAxis = null;
				var values = [];
				var columnInfo = null;
				
				columnInfo = chartData.columns;
				self.resultName = chartData.resultName;
				
				if (columnInfo)
				{
					var columnLabelsArray = []
					var columnLabels = null;
					for (var i = 0; i < columnInfo.length; i++)
					{
						var colInfo = columnInfo[i];
						if (colInfo.type == "number")
						{
							values.push(colInfo.label);
							if (colInfo.format)
							{
								if (colInfo.format.name == "DOLLAR")
									self.formatter[colInfo.label] = d3.format("$" + colInfo.format.width + ",." + colInfo.format.precision + "f");
								else if (colInfo.format.name == "COMMA")
									self.formatter[colInfo.label] = d3.format(colInfo.format.width + ",." + colInfo.format.precision + "f");
								else if (colInfo.format.name == "F")
									self.formatter[colInfo.label] = d3.format(colInfo.format.width + "." + colInfo.format.precision + "f");
								else if (colInfo.format.name == "PERCENT")
									self.formatter[colInfo.label] = d3.format(colInfo.format.width + ",." + colInfo.format.precision + "%");
							}
						}
						else
							xAxis = colInfo.label;
							
						if (columnLabels)
							columnLabels += ",\"" + colInfo.label + "\"";
						else
							columnLabels = "\"" + colInfo.label + "\"";
						columnLabelsArray.push(colInfo.label);
						
					}						
				}		
				
				var arrayData = chartData.data;
				convertDatesToDates(arrayData, columnInfo);
				
				console.dir(arrayData);
				
				//timeseries('timeseries one', getData(new Date(2012, 1, 1), new Date(2015, 1, 2), amount), true);
			}
			
			function convertDatesToDates(data, columnInfo)
			{
				for (var c = 0; c < columnInfo.length; c++)
				{
					var colInfo = columnInfo[c];
					if (colInfo)
					{
						if (colInfo.type == "date")
						{
							if (colInfo.format)
							{
								if (colInfo.format.name == "DATE")
								{
								}
							}
							
							for (var i = 0; i < data.length; i++)
							{
								var old = data[i][c];
								data[i][c] = new Date(old);
								//console.log(old + " : " + data[i][c]);								
							}
						}
					}
				}
			}		
			
		}
    </script>
	
</body>

</html>